Content-Type: multipart/mixed; boundary="==ALI=="
MIME-Version: 1.0

--==ALI==
Content-Type: text/x-shellscript; charset="us-ascii"
MIME-Version: 1.0

config system global
set hostname ali-fgt-active
set admin-sport ${adminsport}
end
config system dns
set primary 169.254.169.253
end
config system interface
edit port1
set alias public
set mode static
set ip ${port1_ip} ${port1_mask}
set allowaccess ping https ssh fgfm
set mtu-override enable
set mtu 9001
next
edit port2
set alias private
set mode static
set ip ${port2_ip} ${port2_mask}
set allowaccess ping https ssh fgfm
set mtu-override enable
set mtu 9001
next
end
config router static
edit 1
set device port1
set gateway ${defaultgwy}
next
edit 2
set dst ${vpc_ip} ${vpc_mask}
set device port2
set gateway ${privategwy}
next
edit 3
set dst ${vpc_cidr_ack1}
set device port2
set gateway ${privategwy}
next
edit 4
set dst ${vpc_cidr_ack2} 
set device port2
set gateway ${privategwy}
next
edit 5
set dst ${vpc_cidr_fortiadc}
set device port2
set gateway ${privategwy}
next
end
config system api-user
    edit ${admin_api_user}
        set accprofile "prof_admin"
        set vdom "root"
        config trusthost
            edit 1
                set ipv4-trusthost ${client_source_ip_subnet}
        end
    next
end
config firewall address
    edit "client-vm"
        set subnet ${client_vm} 255.255.255.255
    next
    edit "fortiadc-vm"
        set subnet ${fortiadc_vm} 255.255.255.255
    next
end

config firewall vip
    edit "client-vm-2022"
        set mappedip ${client_vm}
        set extintf "port1"
        set portforward enable
        set extport 2022
        set mappedport 22
    next
      edit "fortiadc-vm-6022"
        set mappedip ${fortiadc_vm}
        set extintf "port1"
        set portforward enable
        set extport 6022
        set mappedport 22
    next
      edit "fortiadc-vm-9443"
        set mappedip ${fortiadc_vm}
        set extintf "port1"
        set portforward enable
        set extport 9443
        set mappedport 443
     next
      edit "nginx_on_fortiadc_8080"
        set mappedip ${fortiadc_vm}
        set extintf "port1"
        set portforward enable
        set extport 8080
        set mappedport 8080
end


config firewall policy
    edit 1
        set name "port2_port2"
        set srcintf "port2"
        set dstintf "port2"
        set srcaddr "all"
        set dstaddr "all"
        set action accept
        set schedule "always"
        set service "ALL"
        set logtraffic all
    next
    edit 2 
        set name "port2_port1"
        set srcintf "port2"
        set dstintf "port1"
        set srcaddr "all"
        set dstaddr "all"
        set action accept
        set schedule "always"
        set service "ALL"
        set utm-status enable
        set ssl-ssh-profile "certificate-inspection"
        set av-profile "default"
        set webfilter-profile "monitor-all"
        set ips-sensor "default"
        set application-list "default"
        set logtraffic all
        set nat enable
     next
     edit 3
        set name "ingress_to_client_vm_2022"
        set srcintf "port1"
        set dstintf "port2"
        set srcaddr "all"
        set dstaddr "client-vm-2022"
        set action accept
        set schedule "always"
        set service "ALL"
        set logtraffic all
        set nat enable
    next
    edit 4 
        set name "ingress_to_fortiadc_vm_6022"
        set srcintf "port1"
        set dstintf "port2"
        set srcaddr "all"
        set dstaddr "fortiadc-vm-6022"
        set action accept
        set schedule "always"
        set service "ALL"
        set logtraffic all
        set nat enable
    next
    edit 5 
        set name "ingress_to_fortiadc_vm_9443"
        set srcintf "port1"
        set dstintf "port2"
        set srcaddr "all"
        set dstaddr "fortiadc-vm-9443"
        set action accept
        set schedule "always"
        set service "ALL"
        set logtraffic all
        set nat enable
    next
    edit 6
        set name "ingress_to_nginx_fortiadc_8080"
        set srcintf "port1"
        set dstintf "port2"
        set srcaddr "all"
        set dstaddr "nginx_on_fortiadc_8080"
        set action accept
        set schedule "always"
        set service "ALL"
        set logtraffic all
        set nat enable
end



%{ if type == "byol" }
--==ALI==
Content-Type: text/plain; charset="us-ascii"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
Content-Disposition: attachment; filename="license"

${license_file}

%{ endif }
--==ALI==--

